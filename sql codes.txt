CREATE TABLE employees(

   emp_no VARCHAR2(5) PRIMARY KEY,
   emp_name VARCHAR2(20),
   password_hash VARCHAR2(255) NOT NULL,
   status VARCHAR2(20) DEFAULT 'ACTIVE',
   role          VARCHAR2(20) DEFAULT 'USER',
);

INSERT INTO employees (
  emp_no, emp_name, password_hash, role, status
)
VALUES (
  emp_no_seq.NEXTVAL,
  'John Doe',
  'dummy_hash',
  'USER',
  'ACTIVE'
);

COMMIT;

CREATE OR REPLACE PROCEDURE get_employee_details (
  p_input  IN  CLOB,
  p_output OUT CLOB
) AS
  v_emp_no  employees.emp_no%TYPE;
  v_name    employees.emp_name%TYPE;
  v_status  employees.status%TYPE;
  v_role    employees.role%TYPE;
BEGIN
  -- Parse input JSON
  v_emp_no := JSON_VALUE(p_input, '$.emp_no');

  SELECT emp_name, status, role
  INTO v_name, v_status, v_role
  FROM employees
  WHERE emp_no = v_emp_no;

  -- Build output JSON
  p_output := JSON_OBJECT(
    'emp_no' VALUE v_emp_no,
    'name'   VALUE v_name,
    'status' VALUE v_status,
    'role'   VALUE v_role
  );

EXCEPTION
  WHEN NO_DATA_FOUND THEN
    p_output := JSON_OBJECT(
      'error' VALUE 'Employee not found'
    );
END;
/

