CREATE TABLE employees(

   emp_no VARCHAR2(5) PRIMARY KEY,
   emp_name VARCHAR2(20),
   password_hash VARCHAR2(255) NOT NULL,
   status VARCHAR2(20) DEFAULT 'ACTIVE',
   role          VARCHAR2(20) DEFAULT 'USER',
);

INSERT INTO employees (
  emp_no, emp_name, password_hash, role, status
)
VALUES (
  emp_no_seq.NEXTVAL,
  'John Doe',
  'dummy_hash',
  'USER',
  'ACTIVE'
);

COMMIT;

//get by id
CREATE OR REPLACE PROCEDURE get_employee_by_id (
  p_emp_no IN VARCHAR2,
  p_result OUT SYS_REFCURSOR
) IS
BEGIN
  OPEN p_result FOR
    SELECT emp_name, status, role
    FROM employees
    WHERE emp_no = p_emp_no;
END;
/

//get all
CREATE OR REPLACE PROCEDURE get_all_users (
  p_cursor OUT SYS_REFCURSOR
) AS
BEGIN
  OPEN p_cursor FOR
    SELECT emp_no, emp_name, status, role
    FROM employees;
END;
/


// api TABLE

CREATE TABLE procedures (
  procedure_id   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  api_name        VARCHAR2(100) UNIQUE NOT NULL,
  procedure_name  VARCHAR2(100) NOT NULL,
  status          VARCHAR2(20) DEFAULT 'ACTIVE'
);


CREATE TABLE procedure_db_config (
  config_id     NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  procedure_id  NUMBER NOT NULL,
  db_user       VARCHAR2(50) NOT NULL,
  db_password   VARCHAR2(50) NOT NULL,
  db_host       VARCHAR2(50) NOT NULL,
  db_port       VARCHAR2(10) NOT NULL,
  db_service    VARCHAR2(50) NOT NULL,
  CONSTRAINT fk_proc
    FOREIGN KEY (procedure_id)
    REFERENCES procedures(procedure_id)
    ON DELETE CASCADE
);
